{% extends "base.html" %}
{% block content %}
<h2>Leads</h2>
<a href="{{ url_for('add_lead') }}" class="btn btn-primary mb-3">+ Add Lead</a>

<form method="get" class="row mb-3">
  <div class="col-md-4">
    <input type="text" name="search" value="{{ search }}" class="form-control" placeholder="Search name, email, phone">
  </div>
  <div class="col-md-3">
    <select name="status" class="form-select">
      <option value="">All Status</option>
      <option value="New" {% if status_filter=="New" %}selected{% endif %}>New</option>
      <option value="Contacted" {% if status_filter=="Contacted" %}selected{% endif %}>Contacted</option>
      <option value="Converted" {% if status_filter=="Converted" %}selected{% endif %}>Converted</option>
    </select>
  </div>
  <div class="col-md-3">
    <select name="type" class="form-select">
      <option value="">All Types</option>
      <option value="Personal" {% if type_filter=="Personal" %}selected{% endif %}>Personal</option>
      <option value="Business" {% if type_filter=="Business" %}selected{% endif %}>Business</option>
    </select>
  </div>
  <div class="col-md-2">
    <button type="submit" class="btn btn-secondary w-100">Filter</button>
  </div>
</form>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Contact Name</th>
      <th>Business</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Source</th>
      <th>Last Contact</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for lead in leads %}
    <tr>
      <td>{{ lead.contact_name }}</td>
      <td>{{ lead.business_name or '' }}</td>
      <td>{{ lead.email or '' }}</td>
      <td>{{ lead.phone or '' }}</td>
      <td>{{ lead.preferred_contact or '' }}</td>
      <td>{{ lead.last_contacted or '' }}</td>
      <td><span class="badge bg-info">{{ lead.status }}</span></td>
      <td>
        <a href="{{ url_for('edit_lead', lead_id=lead.id) }}" class="btn btn-sm btn-secondary">Edit</a>
        <form action="{{ url_for('delete_lead', lead_id=lead.id) }}" method="post" style="display:inline;">
          <button type="submit" class="btn btn-sm btn-danger">Delete</button>
        </form>
        {% if lead.status != "Converted" %}
        <form action="{{ url_for('convert_lead', lead_id=lead.id) }}" method="post" style="display:inline;">
          <button type="submit" class="btn btn-sm btn-success">Convert</button>
        </form>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<nav aria-label="Lead pagination">
  <ul class="pagination">
    {% if leads.has_prev %}
      <li class="page-item"><a class="page-link" href="{{ url_for('leads', page=leads.prev_num, search=search, status=status_filter, type=type_filter) }}">Previous</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
    {% endif %}

    <li class="page-item disabled"><span class="page-link">Page {{ leads.page }} of {{ leads.pages }}</span></li>

    {% if leads.has_next %}
      <li class="page-item"><a class="page-link" href="{{ url_for('leads', page=leads.next_num, search=search, status=status_filter, type=type_filter) }}">Next</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
    {% endif %}
  </ul>
</nav>

{% endblock %}
